# 工时统计程序打包说明

## 方法一：使用批处理脚本（推荐）

### 单文件模式（推荐，分发方便）

1. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

2. **运行打包脚本**
   - **首选**：双击运行 `build_exe_simple.bat`（最稳定）
   - **备选**：双击运行 `build_exe_onefile.bat`
   - 或者在命令行中运行：
     ```bash
     build_exe_simple.bat
     ```

3. **获取可执行文件**
   - 打包完成后，可执行文件位于 `dist\work_hours_analyzer.exe`
   - **只需要分发这一个exe文件**，无需其他文件
   - 文件大小约50-100MB，首次运行需要几秒钟解压

### 目录模式（文件较小）

1. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

2. **运行打包脚本**
   - 双击运行 `build_exe.bat`
   - 或者在命令行中运行：
     ```bash
     build_exe.bat
     ```

3. **获取可执行文件**
   - 打包完成后，可执行文件位于 `dist\work_hours_analyzer\work_hours_analyzer.exe`
   - 需要分发整个 `dist\work_hours_analyzer` 文件夹

## 方法二：手动使用PyInstaller命令

1. **安装PyInstaller**
   ```bash
   pip install pyinstaller
   ```

2. **使用spec文件打包（推荐）**
   ```bash
   pyinstaller work_hours_analyzer.spec
   ```

3. **或者直接使用命令行打包**
   ```bash
   pyinstaller --onefile --windowed --name=work_hours_analyzer work_hours_analyzer.py
   ```

## 打包参数说明

- `--onefile`: 打包成单个exe文件（文件较大，但分发方便）
- `--windowed` 或 `-w`: 不显示控制台窗口（GUI程序推荐）
- `--name`: 指定生成的可执行文件名称
- `--icon`: 可以指定图标文件（需要.ico格式）

## 分发程序

### 单文件模式（使用 --onefile）
- 只需要分发 `work_hours_analyzer.exe` 一个文件
- 文件较大（通常50-100MB），但使用方便

### 目录模式（默认）
- 需要分发整个 `dist` 文件夹
- 文件较小，但需要保持文件夹结构

## 注意事项

1. **首次运行可能较慢**：打包后的exe文件首次运行时会解压临时文件，可能需要几秒钟

2. **杀毒软件误报**：某些杀毒软件可能会误报PyInstaller打包的程序，这是正常现象，可以添加信任

3. **Windows版本兼容性**：打包的exe文件可以在Windows 7及以上版本运行

4. **文件大小**：由于包含了Python解释器和所有依赖库，exe文件会比较大（通常50-100MB）

5. **测试**：打包完成后，建议在没有安装Python的电脑上测试运行，确保所有功能正常

## 故障排除

### 如果打包失败，请按以下步骤操作：

1. **运行诊断工具**
   - 双击运行 `诊断打包问题.bat`
   - 查看诊断结果，根据提示修复问题

2. **尝试简化版打包脚本**
   - 使用 `build_exe_simple.bat` 而不是 `build_exe_onefile.bat`
   - 简化版使用命令行参数，更稳定

3. **检查常见问题**
   - 确保Python版本在3.8-3.11之间（推荐3.9或3.10）
   - 确保所有依赖已正确安装：`pip install -r requirements.txt`
   - 更新PyInstaller：`pip install --upgrade pyinstaller`
   - 临时禁用杀毒软件（可能拦截打包过程）

4. **查看详细错误信息**
   - 在命令行中运行打包脚本，查看完整错误信息
   - 或者手动运行：`pyinstaller --clean --onefile --windowed work_hours_analyzer.py`

5. **清理并重试**
   - 删除 `build` 和 `dist` 文件夹
   - 删除 `*.spec` 文件（除了我们提供的spec文件）
   - 重新运行打包脚本

## 常见问题

### Q: 打包失败，提示找不到模块？
A: 
1. 运行 `诊断打包问题.bat` 检查依赖
2. 确保已安装所有依赖：`pip install -r requirements.txt`
3. 尝试使用 `build_exe_simple.bat`（包含更多隐藏导入）

### Q: 打包后程序无法运行？
A: 
1. 检查是否有杀毒软件拦截
2. 尝试在命令行中运行查看错误信息
3. 确保目标电脑是Windows 7及以上版本

### Q: 图表中文显示乱码？
A: 确保目标电脑有中文字体（Windows系统通常自带），或者修改代码使用系统字体

### Q: 文件太大怎么办？
A: 可以使用 `--onefile` 模式打包成单个文件，或者使用 `--exclude-module` 排除不需要的模块

### Q: 如何添加程序图标？
A: 准备一个 `.ico` 格式的图标文件，在spec文件中修改 `icon='your_icon.ico'`，或在命令行中添加 `--icon=your_icon.ico`

### Q: 打包时提示UPX相关错误？
A: 已在配置中禁用UPX压缩，如果仍有问题，检查spec文件中的 `upx=False` 设置

